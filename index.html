<!DOCTYPE html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ìŠµê´€ íŠ¸ë˜ì»¤">
    <title>ë‚˜ì˜ ìŠµê´€ íŠ¸ë˜ì»¤ ğŸŒŸ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 900px; margin: 0 auto; }
        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }
        .header h1 { color: #667eea; font-size: 2.5em; margin-bottom: 10px; }
        .score-display {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.5em;
            font-weight: bold;
        }
        .game-status { padding: 15px; border-radius: 10px; margin-top: 15px; font-size: 1.3em; font-weight: bold; }
        .game-status.full { background: #4ade80; color: white; }
        .game-status.half { background: #fbbf24; color: white; }
        .game-status.none { background: #f87171; color: white; }
        .week-reset {
            text-align: center;
            padding: 10px;
            background: #fff3cd;
            border-radius: 10px;
            margin-top: 10px;
            color: #856404;
            font-weight: 600;
        }

```
    /* í–„ë²„ê±° ë©”ë‰´ - ì™„ì „íˆ ìƒˆë¡œìš´ êµ¬ì¡° */
    .menu-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        background: white;
        border: 3px solid #667eea;
        border-radius: 50%;
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        cursor: pointer;
        z-index: 9999;
        display: flex !important;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 5px;
        padding: 0;
    }
    .menu-btn span {
        width: 24px;
        height: 4px;
        background: #667eea;
        border-radius: 2px;
        transition: 0.3s;
        display: block !important;
    }
    .menu-btn.active span:nth-child(1) { transform: translateY(8px) rotate(45deg); }
    .menu-btn.active span:nth-child(2) { opacity: 0; }
    .menu-btn.active span:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }
    
    .menu-backdrop {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 9997;
    }
    .menu-backdrop.open { display: block; }
    
    .menu-panel {
        position: fixed;
        top: 0;
        right: -320px;
        width: 300px;
        height: 100%;
        background: white;
        z-index: 9998;
        padding: 80px 20px 20px;
        transition: right 0.3s ease;
        box-shadow: -5px 0 15px rgba(0,0,0,0.3);
    }
    .menu-panel.open { right: 0; }
    .menu-panel h3 { color: #667eea; margin-bottom: 20px; font-size: 1.5em; }
    .menu-panel button {
        width: 100%;
        padding: 15px;
        margin-bottom: 10px;
        background: #f0f0f0;
        border: none;
        border-radius: 10px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        text-align: left;
    }
    .menu-panel button:active { background: #e0e0e0; }
    .menu-panel button.danger { color: #ef4444; }
    
    .card {
        background: white;
        border-radius: 20px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .card h2 { color: #667eea; margin-bottom: 20px; font-size: 1.8em; }
    .habit-item {
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        border-left: 5px solid #667eea;
    }
    .habit-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }
    .habit-header label {
        font-size: 1.2em;
        font-weight: 600;
        color: #333;
        flex: 1;
    }
    .habit-header input[type="checkbox"] { width: 25px; height: 25px; cursor: pointer; }
    .points {
        background: #667eea;
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: bold;
    }
    textarea, input[type="text"], input[type="date"], input[type="password"] {
        width: 100%;
        padding: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1em;
        font-family: inherit;
        margin-top: 5px;
    }
    textarea { resize: vertical; min-height: 80px; }
    input:focus, textarea:focus { outline: none; border-color: #667eea; }
    .field-group { margin-bottom: 10px; }
    .field-label { font-size: 0.9em; color: #666; margin-bottom: 3px; font-weight: 500; }
    .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 10px;
        font-size: 1.2em;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        margin-top: 20px;
    }
    .btn:active { transform: scale(0.98); }
    .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .tab {
        flex: 1;
        min-width: 120px;
        padding: 15px;
        background: #e0e0e0;
        border: none;
        border-radius: 10px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
    }
    .tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 15px;
        text-align: center;
    }
    .stat-number { font-size: 2.5em; font-weight: bold; margin: 10px 0; }
    .stat-label { font-size: 1em; opacity: 0.9; }
    .week-calendar {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 10px;
        margin-top: 20px;
    }
    .day-box {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        border: 2px solid #e0e0e0;
    }
    .day-box.completed { background: #d1fae5; border-color: #4ade80; }
    .day-name { font-weight: bold; color: #667eea; margin-bottom: 5px; }
    .day-score { font-size: 1.5em; font-weight: bold; color: #333; }
    .reading-log {
        background: #f0f4ff;
        padding: 12px;
        border-radius: 8px;
        margin-top: 8px;
        border-left: 3px solid #667eea;
    }
    .reading-log-title { font-weight: bold; color: #667eea; margin-bottom: 5px; }
    .reading-log-detail { font-size: 0.9em; color: #555; margin: 3px 0; }
    .history { max-height: 400px; overflow-y: auto; }
    .history-item {
        background: #f8f9fa;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 10px;
        border-left: 5px solid #764ba2;
    }
    .history-date { font-weight: bold; color: #667eea; margin-bottom: 10px; }
    .history-content { margin-left: 10px; color: #555; line-height: 1.6; }
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        z-index: 10000;
        align-items: center;
        justify-content: center;
    }
    .modal.show { display: flex; }
    .modal-content {
        background: white;
        padding: 40px;
        border-radius: 20px;
        text-align: center;
        max-width: 500px;
        margin: 20px;
    }
    .modal-emoji { font-size: 5em; margin-bottom: 20px; }
    .modal-title { font-size: 2em; font-weight: bold; color: #667eea; margin-bottom: 15px; }
    .modal-message { font-size: 1.3em; color: #555; margin-bottom: 30px; line-height: 1.6; }
    .modal-close {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 40px;
        border: none;
        border-radius: 10px;
        font-size: 1.2em;
        font-weight: bold;
        cursor: pointer;
    }
    .celebration {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 5em;
        z-index: 1000;
        animation: celebrate 2s ease-out;
        pointer-events: none;
    }
    @keyframes celebrate {
        0% { opacity: 0; transform: translate(-50%, -50%) scale(0); }
        50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
        100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
    }
    .confetti { position: fixed; width: 10px; height: 10px; z-index: 999; pointer-events: none; }
    @keyframes confetti-fall {
        to { transform: translateY(100vh) rotate(360deg); opacity: 0; }
    }
</style>
```

</head>
<body>
    <button class="menu-btn" id="menuBtn">
        <span></span>
        <span></span>
        <span></span>
    </button>

```
<div class="menu-backdrop" id="menuBackdrop"></div>

<div class="menu-panel" id="menuPanel">
    <h3>âš™ï¸ ê´€ë¦¬ ë©”ë‰´</h3>
    <button id="backupBtn">ğŸ’¾ JSON ë°±ì—…</button>
    <button id="restoreBtn">ğŸ“¥ ë°ì´í„° ë³µì›</button>
    <button id="excelBtn">ğŸ“Š ì—‘ì…€ ë‚´ë³´ë‚´ê¸°</button>
    <button id="debugBtn">ğŸ” ë°ì´í„° í™•ì¸</button>
    <button id="fixBtn" class="danger">ğŸ”§ ì ìˆ˜ ì¬ê³„ì‚°</button>
</div>

<input type="file" id="fileInput" accept=".json" style="display:none;">

<div class="container">
    <div class="header">
        <h1>ğŸŒŸ ë‚˜ì˜ ìŠµê´€ íŠ¸ë˜ì»¤ ğŸŒŸ</h1>
        <div class="score-display">
            ì´ë²ˆ ì£¼ ì ìˆ˜: <span id="totalScore">0</span>ì 
        </div>
        <div id="gameStatus" class="game-status none">ê²Œì„ ë¶ˆê°€ëŠ¥ ğŸ˜¢</div>
        <div class="week-reset">ë§¤ì£¼ í† ìš”ì¼ë§ˆë‹¤ ì ìˆ˜ê°€ ë¦¬ì…‹ë©ë‹ˆë‹¤ (í† ìš”ì¼~ê¸ˆìš”ì¼)</div>
    </div>

    <div class="tabs">
        <button class="tab active" id="tab0">ì˜¤ëŠ˜ì˜ ê¸°ë¡</button>
        <button class="tab" id="tab1">ì´ë²ˆ ì£¼</button>
        <button class="tab" id="tab2">ì´ë²ˆ ë‹¬</button>
        <button class="tab" id="tab3">ì „ì²´ ê¸°ë¡</button>
    </div>

    <div id="todayTab" class="tab-content active">
        <div class="card">
            <h2>ğŸ“š ì˜¤ëŠ˜ì˜ ìŠµê´€ ê¸°ë¡</h2>
            <div style="margin-bottom:20px;">
                <div class="field-label">ğŸ“… ë‚ ì§œ ì„ íƒ</div>
                <input type="date" id="dateInput">
                <p id="dateWarning" style="color:#f59e0b;margin-top:8px;font-size:0.9em;display:none;">âš ï¸ ê³¼ê±° ë‚ ì§œë¥¼ ìˆ˜ì •í•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”í•´ìš”</p>
            </div>
            <p style="color:#666;margin-bottom:20px;">ì„ íƒí•œ ë‚ ì§œ: <strong id="dateDisplay"></strong></p>

            <div class="habit-item">
                <div class="habit-header">
                    <input type="checkbox" id="readingCheck">
                    <label for="readingCheck">ğŸ“– ë…ì„œí–ˆë‚˜ìš”?</label>
                    <span class="points">+10ì </span>
                </div>
                <div id="readingFields" style="display:none;margin-top:10px;">
                    <div class="field-group">
                        <div class="field-label">ğŸ“• ì±… ì œëª©</div>
                        <input type="text" id="bookTitle" placeholder="ì½ì€ ì±…ì˜ ì œëª©ì„ ì ì–´ì£¼ì„¸ìš”">
                    </div>
                    <div class="field-group">
                        <div class="field-label">âœï¸ ì €ì</div>
                        <input type="text" id="bookAuthor" placeholder="ì €ì ì´ë¦„ì„ ì ì–´ì£¼ì„¸ìš”">
                    </div>
                    <div class="field-group">
                        <div class="field-label">ğŸ“ ì˜¤ëŠ˜ ì½ì€ ë‚´ìš©</div>
                        <textarea id="readingText" placeholder="ì˜¤ëŠ˜ ì–´ë–¤ ë‚´ìš©ì„ ì½ì—ˆë‚˜ìš”?"></textarea>
                    </div>
                </div>
            </div>

            <div class="habit-item">
                <div class="habit-header">
                    <input type="checkbox" id="choreCheck">
                    <label for="choreCheck">ğŸ§¹ ì§‘ì•ˆì¼ì„ ë„ì™”ë‚˜ìš”?</label>
                    <span class="points">+5ì </span>
                </div>
                <div id="choreFields" style="display:none;margin-top:10px;">
                    <textarea id="choreText" placeholder="ì–´ë–¤ ì§‘ì•ˆì¼ì„ í–ˆë‚˜ìš”?"></textarea>
                </div>
            </div>

            <div class="habit-item">
                <div class="habit-header">
                    <input type="checkbox" id="specialCheck">
                    <label for="specialCheck">â­ íŠ¹ë³„íˆ ì˜í•œ ì¼ì´ ìˆë‚˜ìš”?</label>
                    <span class="points">+15ì </span>
                </div>
                <div id="specialFields" style="display:none;margin-top:10px;">
                    <textarea id="specialText" placeholder="ì˜¤ëŠ˜ ìŠ¤ìŠ¤ë¡œ ëŒ€ê²¬í•˜ê²Œ ìƒê°í•˜ëŠ” ì¼ì„ ì ì–´ë³´ì„¸ìš”!"></textarea>
                </div>
            </div>

            <div class="habit-item" style="border-left-color:#f87171;">
                <div class="habit-header">
                    <input type="checkbox" id="tantrumCheck">
                    <label for="tantrumCheck">ğŸ˜¤ ë‚´ë§˜ëŒ€ë¡œ í•˜ë ¤ê³  ì§œì¦ëƒˆë‚˜ìš”?</label>
                    <span class="points" style="background:#f87171;">-10ì </span>
                </div>
                <div id="tantrumFields" style="display:none;margin-top:10px;">
                    <textarea id="tantrumText" placeholder="ì–´ë–¤ ìƒí™©ì´ì—ˆë‚˜ìš”?"></textarea>
                </div>
            </div>

            <button class="btn" id="saveBtn">ğŸ’¾ ì˜¤ëŠ˜ì˜ ê¸°ë¡ ì €ì¥í•˜ê¸°</button>
        </div>
    </div>

    <div id="weekTab" class="tab-content">
        <div class="card">
            <h2>ğŸ“Š ì´ë²ˆ ì£¼ í†µê³„</h2>
            <div id="weekPeriod" style="color:#666;margin-bottom:20px;"></div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ğŸ“– ë…ì„œ</div>
                    <div class="stat-number" id="weekReading">0</div>
                    <div class="stat-label">ì¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ğŸ§¹ ì§‘ì•ˆì¼</div>
                    <div class="stat-number" id="weekChore">0</div>
                    <div class="stat-label">ì¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">â­ íŠ¹ë³„í•œ ì¼</div>
                    <div class="stat-number" id="weekSpecial">0</div>
                    <div class="stat-label">ì¼</div>
                </div>
            </div>
            <h3 style="color:#667eea;margin:20px 0;">ì¼ë³„ ì ìˆ˜</h3>
            <div class="week-calendar" id="weekCalendar"></div>
        </div>
    </div>

    <div id="monthTab" class="tab-content">
        <div class="card">
            <h2>ğŸ“… ì´ë²ˆ ë‹¬ í†µê³„</h2>
            <div id="monthPeriod" style="color:#666;margin-bottom:20px;"></div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ğŸ“– ë…ì„œ</div>
                    <div class="stat-number" id="monthReading">0</div>
                    <div class="stat-label">ì¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ğŸ§¹ ì§‘ì•ˆì¼</div>
                    <div class="stat-number" id="monthChore">0</div>
                    <div class="stat-label">ì¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">â­ íŠ¹ë³„í•œ ì¼</div>
                    <div class="stat-number" id="monthSpecial">0</div>
                    <div class="stat-label">ì¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ğŸ“š ì´ ì½ì€ ì±…</div>
                    <div class="stat-number" id="monthBooks">0</div>
                    <div class="stat-label">ê¶Œ</div>
                </div>
            </div>
            <h3 style="color:#667eea;margin:20px 0;">ì´ë²ˆ ë‹¬ ì½ì€ ì±…ë“¤</h3>
            <div id="monthBooksList"></div>
        </div>
    </div>

    <div id="historyTab" class="tab-content">
        <div class="card">
            <h2>ğŸ“– ì „ì²´ ê¸°ë¡ ë³´ê¸°</h2>
            <div class="history" id="historyList">
                <p style="text-align:center;color:#999;padding:40px;">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”. ì˜¤ëŠ˜ë¶€í„° ì‹œì‘í•´ë³¼ê¹Œìš”? ğŸ˜Š</p>
            </div>
        </div>
    </div>
</div>

<div id="weekendModal" class="modal">
    <div class="modal-content">
        <div class="modal-emoji" id="weekendEmoji">ğŸ®</div>
        <div class="modal-title" id="weekendTitle">ê²°ê³¼</div>
        <div class="modal-message" id="weekendMessage">ë©”ì‹œì§€</div>
        <button class="modal-close" id="weekendClose">í™•ì¸</button>
    </div>
</div>

<div id="passwordModal" class="modal">
    <div class="modal-content">
        <div class="modal-emoji">ğŸ”’</div>
        <div class="modal-title">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</div>
        <div class="modal-message">ê³¼ê±° ë‚ ì§œë¥¼ ìˆ˜ì •í•˜ë ¤ë©´<br>ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
        <input type="password" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸" style="width:100%;padding:15px;font-size:1.2em;border:2px solid #667eea;border-radius:10px;margin-bottom:20px;text-align:center;">
        <div style="display:flex;gap:10px;">
            <button class="modal-close" id="passwordCancel" style="flex:1;background:#ccc;">ì·¨ì†Œ</button>
            <button class="modal-close" id="passwordOk" style="flex:1;">í™•ì¸</button>
        </div>
    </div>
</div>
```

<script>
// ì „ì—­ ë³€ìˆ˜
var selectedDate = '';
var isPasswordVerified = false;

// ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
});

function initializeApp() {
    // ë©”ë‰´ ì´ë²¤íŠ¸
    document.getElementById('menuBtn').addEventListener('click', toggleMenu);
    document.getElementById('menuBackdrop').addEventListener('click', closeMenu);
    document.getElementById('backupBtn').addEventListener('click', doBackup);
    document.getElementById('restoreBtn').addEventListener('click', doRestore);
    document.getElementById('excelBtn').addEventListener('click', doExcel);
    document.getElementById('debugBtn').addEventListener('click', doDebug);
    document.getElementById('fixBtn').addEventListener('click', doFix);
    
    // íŒŒì¼ ë³µì›
    document.getElementById('fileInput').addEventListener('change', handleFileRestore);
    
    // ì²´í¬ë°•ìŠ¤
    document.getElementById('readingCheck').addEventListener('change', function() {
        document.getElementById('readingFields').style.display = this.checked ? 'block' : 'none';
    });
    document.getElementById('choreCheck').addEventListener('change', function() {
        document.getElementById('choreFields').style.display = this.checked ? 'block' : 'none';
    });
    document.getElementById('specialCheck').addEventListener('change', function() {
        document.getElementById('specialFields').style.display = this.checked ? 'block' : 'none';
    });
    document.getElementById('tantrumCheck').addEventListener('change', function() {
        document.getElementById('tantrumFields').style.display = this.checked ? 'block' : 'none';
    });
    
    // íƒ­
    for(var i=0; i<4; i++) {
        document.getElementById('tab'+i).addEventListener('click', (function(idx) {
            return function() { switchTab(idx); };
        })(i));
    }
    
    // ì €ì¥
    document.getElementById('saveBtn').addEventListener('click', saveRecord);
    
    // ë‚ ì§œ
    document.getElementById('dateInput').addEventListener('change', handleDateChange);
    
    // ëª¨ë‹¬
    document.getElementById('weekendClose').addEventListener('click', function() {
        document.getElementById('weekendModal').classList.remove('show');
    });
    document.getElementById('passwordOk').addEventListener('click', handlePasswordOk);
    document.getElementById('passwordCancel').addEventListener('click', handlePasswordCancel);
    document.getElementById('passwordInput').addEventListener('keypress', function(e) {
        if(e.key === 'Enter') handlePasswordOk();
    });
    
    // ì´ˆê¸° ë¡œë“œ
    updateDate();
    updateScore();
    loadToday();
    checkFriday();
}

// ë©”ë‰´ í•¨ìˆ˜
function toggleMenu() {
    var btn = document.getElementById('menuBtn');
    var panel = document.getElementById('menuPanel');
    var backdrop = document.getElementById('menuBackdrop');
    btn.classList.toggle('active');
    panel.classList.toggle('open');
    backdrop.classList.toggle('open');
}

function closeMenu() {
    document.getElementById('menuBtn').classList.remove('active');
    document.getElementById('menuPanel').classList.remove('open');
    document.getElementById('menuBackdrop').classList.remove('open');
}

// ë°±ì—…/ë³µì› í•¨ìˆ˜
function doBackup() {
    closeMenu();
    try {
        var backup = {};
        for(var i=0; i<localStorage.length; i++) {
            var key = localStorage.key(i);
            backup[key] = localStorage.getItem(key);
        }
        var dataStr = JSON.stringify(backup, null, 2);
        var blob = new Blob([dataStr], {type:'application/json'});
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = 'ìŠµê´€ê¸°ë¡_ë°±ì—…_'+new Date().toISOString().split('T')[0]+'.json';
        a.click();
        URL.revokeObjectURL(url);
        alert('âœ… ë°ì´í„°ê°€ JSON íŒŒì¼ë¡œ ë°±ì—…ë˜ì—ˆì–´ìš”!');
    } catch(e) {
        alert('âŒ ë°±ì—… ì¤‘ ì˜¤ë¥˜: '+e.message);
    }
}

function doRestore() {
    closeMenu();
    document.getElementById('fileInput').click();
}

function handleFileRestore(e) {
    var file = e.target.files[0];
    if(!file) return;
    var reader = new FileReader();
    reader.onload = function(event) {
        try {
            var backup = JSON.parse(event.target.result);
            for(var key in backup) {
                localStorage.setItem(key, backup[key]);
            }
            alert('âœ… ë°ì´í„°ê°€ ë³µì›ë˜ì—ˆì–´ìš”! í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
            location.reload();
        } catch(e) {
            alert('âŒ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: '+e.message);
        }
    };
    reader.readAsText(file);
}

function doExcel() {
    closeMenu();
    try {
        var keys = Object.keys(localStorage).filter(function(k) { return k.indexOf('day_')===0; }).sort();
        if(keys.length === 0) {
            alert('ì•„ì§ ë‚´ë³´ë‚¼ ê¸°ë¡ì´ ì—†ì–´ìš”.');
            return;
        }
        
        var csv = 'ë‚ ì§œ,ì ìˆ˜,í•­ëª©,ì±…ì œëª©,ì €ì,ë‚´ìš©\n';
        for(var i=0; i<keys.length; i++) {
            var data = JSON.parse(localStorage.getItem(keys[i]));
            var date = new Date(data.date);
            var dateStr = date.toLocaleDateString('ko-KR');
            var score = (data.reading?10:0)+(data.chore?5:0)+(data.special?15:0)+(data.tantrum?-10:0);
            
            if(data.reading) {
                csv += '"'+dateStr+'","'+score+'","ë…ì„œ","'+(data.bookTitle||'').replace(/"/g,'""')+'","'+(data.bookAuthor||'').replace(/"/g,'""')+'","'+(data.readingText||'').replace(/"/g,'""')+'"\n';
            }
            if(data.chore) {
                csv += '"'+dateStr+'","'+score+'","ì§‘ì•ˆì¼ ì°¸ì—¬","","","'+(data.choreText||'').replace(/"/g,'""')+'"\n';
            }
            if(data.special) {
                csv += '"'+dateStr+'","'+score+'","íŠ¹ë³„íˆ ì˜í•œ ì¼","","","'+(data.specialText||'').replace(/"/g,'""')+'"\n';
            }
            if(data.tantrum) {
                csv += '"'+dateStr+'","'+score+'","ë‚´ ë§˜ëŒ€ë¡œ ì§œì¦","","","'+(data.tantrumText||'').replace(/"/g,'""')+'"\n';
            }
            if(!data.reading && !data.chore && !data.special && !data.tantrum) {
                csv += '"'+dateStr+'","0","ê¸°ë¡ ì—†ìŒ","","",""\n';
            }
        }
        
        var blob = new Blob(['\uFEFF'+csv], {type:'text/csv;charset=utf-8'});
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = 'ìŠµê´€ê¸°ë¡_'+new Date().toISOString().split('T')[0]+'.csv';
        a.click();
        URL.revokeObjectURL(url);
        alert('âœ… ì—‘ì…€ íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ!');
    } catch(e) {
        alert('âŒ ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜: '+e.message);
    }
}

function doDebug() {
    closeMenu();
    var weekStart = getWeekStart(new Date());
    var weekStartStr = weekStart.toISOString().split('T')[0];
    var info = '=== ë””ë²„ê·¸ ì •ë³´ ===\n\n';
    info += 'ì˜¤ëŠ˜ ë‚ ì§œ: '+new Date().toISOString().split('T')[0]+'\n';
    info += 'ì´ë²ˆ ì£¼ ì‹œì‘: '+weekStartStr+'\n\n';
    
    var weekData = localStorage.getItem('week_'+weekStartStr);
    info += 'ì£¼ê°„ ë°ì´í„°:\n';
    if(weekData) {
        var parsed = JSON.parse(weekData);
        info += 'ì´ì : '+parsed.total+'\nì¼ë³„ ì ìˆ˜:\n';
        for(var date in parsed.days) {
            info += '  '+date+': '+parsed.days[date]+'ì \n';
        }
    } else {
        info += 'ì—†ìŒ\n';
    }
    
    info += '\nì¼ë³„ ìƒì„¸ ë°ì´í„°:\n';
    var dayKeys = Object.keys(localStorage).filter(function(k) { return k.indexOf('day_')===0; }).sort();
    for(var i=0; i<dayKeys.length; i++) {
        var data = JSON.parse(localStorage.getItem(dayKeys[i]));
        var date = dayKeys[i].replace('day_','');
        var score = (data.reading?10:0)+(data.chore?5:0)+(data.special?15:0)+(data.tantrum?-10:0);
        info += '\n'+date+':\n';
        info += '  ë…ì„œ: '+(data.reading?'O':'X')+'\n';
        info += '  ì§‘ì•ˆì¼: '+(data.chore?'O':'X')+'\n';
        info += '  íŠ¹ë³„í•œì¼: '+(data.special?'O':'X')+'\n';
        info += '  ì§œì¦: '+(data.tantrum?'O':'X')+'\n';
        info += '  ê³„ì‚°ëœ ì ìˆ˜: '+score+'ì \n';
    }
    alert(info);
}

function doFix() {
    closeMenu();
    if(!confirm('ì¼ë³„ ê¸°ë¡ì„ ë°”íƒ•ìœ¼ë¡œ ì£¼ê°„ ì ìˆ˜ë¥¼ ë‹¤ì‹œ ê³„ì‚°í•©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ì–´ìš”?')) return;
    
    var weekStart = getWeekStart(new Date());
    var weekStartStr = weekStart.toISOString().split('T')[0];
    var totalScore = 0;
    var dayScores = {};
    
    for(var i=0; i<7; i++) {
        var currentDate = new Date(weekStart);
        currentDate.setDate(currentDate.getDate()+i);
        var dateStr = currentDate.toISOString().split('T')[0];
        var dayData = localStorage.getItem('day_'+dateStr);
        if(dayData) {
            var data = JSON.parse(dayData);
            var score = (data.reading?10:0)+(data.chore?5:0)+(data.special?15:0)+(data.tantrum?-10:0);
            dayScores[dateStr] = score;
            totalScore += score;
        }
    }
    
    localStorage.setItem('week_'+weekStartStr, JSON.stringify({total:totalScore, days:dayScores}));
    alert('âœ… ì£¼ê°„ ì ìˆ˜ ì¬ê³„ì‚° ì™„ë£Œ!\nì´ì : '+totalScore+'ì ');
    updateScore();
    location.reload();
}

// ë‚ ì§œ í•¨ìˆ˜
function updateDate() {
    var today = new Date();
    var todayStr = today.toISOString().split('T')[0];
    document.getElementById('dateInput').value = todayStr;
    document.getElementById('dateInput').max = todayStr;
    document.getElementById('dateDisplay').textContent = today.toLocaleDateString('ko-KR', {
        year:'numeric', month:'long', day:'numeric', weekday:'long'
    });
    selectedDate = todayStr;
}

function handleDateChange() {
    var newDate = document.getElementById('dateInput').value;
    var today = new Date().toISOString().split('T')[0];
    var warning = document.getElementById('dateWarning');
    
    if(newDate > today) {
        alert('âš ï¸ ë¯¸ë˜ ë‚ ì§œëŠ” ì„ íƒí•  ìˆ˜ ì—†ì–´ìš”!');
        document.getElementById('dateInput').value = selectedDate;
        return;
    }
    
    if(newDate < today) {
        warning.style.display = 'block';
        if(!isPasswordVerified) {
            showPasswordModal(function(password) {
                if(password !== '1313') {
                    alert('âŒ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì–´ìš”!');
                    document.getElementById('dateInput').value = today;
                    warning.style.display = 'none';
                    updateDate();
                    loadDateData(today);
                    return;
                }
                isPasswordVerified = true;
                alert('âœ… ë¹„ë°€ë²ˆí˜¸ í™•ì¸! ê³¼ê±° ë‚ ì§œë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ìš”.');
                selectedDate = newDate;
                updateDateDisplay(newDate);
                loadDateData(newDate);
            });
            return;
        }
    } else {
        warning.style.display = 'none';
        isPasswordVerified = false;
    }
    
    selectedDate = newDate;
    updateDateDisplay(newDate);
    loadDateData(newDate);
}

function updateDateDisplay(dateStr) {
    var date = new Date(dateStr+'T00:00:00');
    document.getElementById('dateDisplay').textContent = date.toLocaleDateString('ko-KR', {
        year:'numeric', month:'long', day:'numeric', weekday:'long'
    });
}

// ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬
var passwordCallback = null;

function showPasswordModal(callback) {
    passwordCallback = callback;
    document.getElementById('passwordInput').value = '';
    document.getElementById('passwordModal').classList.add('show');
    document.getElementById('passwordInput').focus();
}

function handlePasswordOk() {
    var password = document.getElementById('passwordInput').value;
    document.getElementById('passwordModal').classList.remove('show');
    if(passwordCallback) passwordCallback(password);
    passwordCallback = null;
}

function handlePasswordCancel() {
    document.getElementById('passwordModal').classList.remove('show');
    if(passwordCallback) passwordCallback('');
    passwordCallback = null;
}

// ë°ì´í„° ë¡œë“œ
function loadToday() {
    var today = new Date().toISOString().split('T')[0];
    loadDateData(today);
}

function loadDateData(dateStr) {
    // ì´ˆê¸°í™”
    document.getElementById('readingCheck').checked = false;
    document.getElementById('readingFields').style.display = 'none';
    document.getElementById('bookTitle').value = '';
    document.getElementById('bookAuthor').value = '';
    document.getElementById('readingText').value = '';
    
    document.getElementById('choreCheck').checked = false;
    document.getElementById('choreFields').style.display = 'none';
    document.getElementById('choreText').value = '';
    
    document.getElementById('specialCheck').checked = false;
    document.getElementById('specialFields').style.display = 'none';
    document.getElementById('specialText').value = '';
    
    document.getElementById('tantrumCheck').checked = false;
    document.getElementById('tantrumFields').style.display = 'none';
    document.getElementById('tantrumText').value = '';
    
    // ë°ì´í„° ë¡œë“œ
    try {
        var data = JSON.parse(localStorage.getItem('day_'+dateStr));
        if(data) {
            if(data.reading) {
                document.getElementById('readingCheck').checked = true;
                document.getElementById('readingFields').style.display = 'block';
                document.getElementById('bookTitle').value = data.bookTitle || '';
                document.getElementById('bookAuthor').value = data.bookAuthor || '';
                document.getElementById('readingText').value = data.readingText || '';
            }
            if(data.chore) {
                document.getElementById('choreCheck').checked = true;
                document.getElementById('choreFields').style.display = 'block';
                document.getElementById('choreText').value = data.choreText || '';
            }
            if(data.special) {
                document.getElementById('specialCheck').checked = true;
                document.getElementById('specialFields').style.display = 'block';
                document.getElementById('specialText').value = data.specialText || '';
            }
            if(data.tantrum) {
                document.getElementById('tantrumCheck').checked = true;
                document.getElementById('tantrumFields').style.display = 'block';
                document.getElementById('tantrumText').value = data.tantrumText || '';
            }
        }
    } catch(e) {}
}

// ì €ì¥
function saveRecord() {
    var dateStr = selectedDate;
    var today = new Date().toISOString().split('T')[0];
    
    if(dateStr < today && !isPasswordVerified) {
        alert('âŒ ê³¼ê±° ë‚ ì§œë¥¼ ì €ì¥í•˜ë ¤ë©´ ë¨¼ì € ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì•¼ í•´ìš”!');
        return;
    }
    
    var data = {
        reading: document.getElementById('readingCheck').checked,
        bookTitle: document.getElementById('bookTitle').value,
        bookAuthor: document.getElementById('bookAuthor').value,
        readingText: document.getElementById('readingText').value,
        chore: document.getElementById('choreCheck').checked,
        choreText: document.getElementById('choreText').value,
        special: document.getElementById('specialCheck').checked,
        specialText: document.getElementById('specialText').value,
        tantrum: document.getElementById('tantrumCheck').checked,
        tantrumText: document.getElementById('tantrumText').value,
        date: dateStr
    };
    
    var score = (data.reading?10:0)+(data.chore?5:0)+(data.special?15:0)+(data.tantrum?-10:0);
    
    try {
        localStorage.setItem('day_'+dateStr, JSON.stringify(data));
        
        var weekStart = getWeekStart(new Date(dateStr+'T00:00:00'));
        var weekStartStr = weekStart.toISOString().split('T')[0];
        var weekData = JSON.parse(localStorage.getItem('week_'+weekStartStr) || '{"total":0,"days":{}}');
        var oldScore = weekData.days[dateStr] || 0;
        weekData.total = weekData.total - oldScore + score;
        weekData.days[dateStr] = score;
        localStorage.setItem('week_'+weekStartStr, JSON.stringify(weekData));
        
        console.log('ì €ì¥ ì™„ë£Œ:', {
            ë‚ ì§œ: dateStr,
            ì ìˆ˜: score,
            ì£¼ì‹œì‘: weekStartStr,
            ì£¼ê°„ì´ì : weekData.total
        });
        
        // ì ìˆ˜ ì—…ë°ì´íŠ¸ (í˜„ì¬ ì£¼)
        updateScore();
        
        if(score >= 15 && dateStr === today) {
            showCelebration();
            setTimeout(function() {
                alert('âœ… ì˜¤ëŠ˜ 15ì  ì´ìƒ ë‹¬ì„±! ì •ë§ ë©‹ì ¸ìš”! ğŸ‰ğŸ‰ğŸ‰');
            }, 500);
        } else {
            alert('âœ… ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆì–´ìš”! ì˜í–ˆì–´ìš”! ğŸ‰\n\n' + 
                  'ì´ë²ˆ ì£¼ ì´ì : ' + (weekStartStr === getWeekStart(new Date()).toISOString().split('T')[0] ? weekData.total : document.getElementById('totalScore').textContent) + 'ì ');
        }
        
        if(dateStr < today) {
            isPasswordVerified = false;
            document.getElementById('dateInput').value = today;
            document.getElementById('dateWarning').style.display = 'none';
            updateDate();
            loadDateData(today);
        }
    } catch(e) {
        alert('âŒ ì €ì¥ ì˜¤ë¥˜: '+e.message);
        console.error(e);
    }
}

// ì£¼ ì‹œì‘ì¼ ê³„ì‚°
function getWeekStart(date) {
    var d = new Date(date);
    var day = d.getDay();
    var diff = day===6 ? 0 : (day===0 ? -1 : -(day+1));
    var result = new Date(d);
    result.setDate(d.getDate()+diff);
    return result;
}

// ì ìˆ˜ ì—…ë°ì´íŠ¸
function updateScore() {
    var weekStart = getWeekStart(new Date());
    var weekStartStr = weekStart.toISOString().split('T')[0];
    try {
        var weekData = JSON.parse(localStorage.getItem('week_'+weekStartStr) || '{"total":0,"days":{}}');
        document.getElementById('totalScore').textContent = weekData.total;
        var statusEl = document.getElementById('gameStatus');
        if(weekData.total >= 70) {
            statusEl.className = 'game-status full';
            statusEl.innerHTML = 'ğŸ®ğŸ® ì£¼ë§ ì–‘ì¼ ê²Œì„ ê°€ëŠ¥! ì˜í•˜ê³  ìˆì–´ìš”!';
        } else if(weekData.total >= 40) {
            statusEl.className = 'game-status half';
            statusEl.innerHTML = 'ğŸ® ì£¼ë§ í•˜ë£¨ ê²Œì„ ê°€ëŠ¥! ì¡°ê¸ˆë§Œ ë” í™”ì´íŒ…!';
        } else {
            statusEl.className = 'game-status none';
            statusEl.innerHTML = 'ğŸ˜¢ ì•„ì§ ê²Œì„ ë¶ˆê°€ëŠ¥... í˜ë‚´ìš”!';
        }
    } catch(e) {}
}

// ì¶•í•˜ íš¨ê³¼
function showCelebration() {
    var cel = document.createElement('div');
    cel.className = 'celebration';
    cel.innerHTML = 'ğŸ‰';
    document.body.appendChild(cel);
    setTimeout(function() { cel.remove(); }, 2000);
    
    var colors = ['#ff6b6b','#4ecdc4','#45b7d1','#f9ca24','#6c5ce7','#a29bfe'];
    for(var i=0; i<50; i++) {
        (function(idx) {
            setTimeout(function() {
                var con = document.createElement('div');
                con.className = 'confetti';
                con.style.left = Math.random()*100+'%';
                con.style.top = '-10px';
                con.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
                con.style.animation = 'confetti-fall '+(2+Math.random()*2)+'s linear';
                document.body.appendChild(con);
                setTimeout(function() { con.remove(); }, 4000);
            }, idx*30);
        })(i);
    }
}

// ê¸ˆìš”ì¼ ì²´í¬
function checkFriday() {
    var today = new Date();
    if(today.getDay() === 5) {
        var weekStart = getWeekStart(today);
        var weekStartStr = weekStart.toISOString().split('T')[0];
        try {
            var weekData = JSON.parse(localStorage.getItem('week_'+weekStartStr) || '{"total":0,"days":{}}');
            var todayStr = today.toISOString().split('T')[0];
            var modalShown = localStorage.getItem('modal_'+todayStr);
            if(!modalShown) {
                setTimeout(function() {
                    showWeekendModal(weekData.total);
                    localStorage.setItem('modal_'+todayStr, 'true');
                }, 3000);
            }
        } catch(e) {}
    }
}

function showWeekendModal(score) {
    var modal = document.getElementById('weekendModal');
    var emoji = document.getElementById('weekendEmoji');
    var title = document.getElementById('weekendTitle');
    var message = document.getElementById('weekendMessage');
    
    if(score >= 70) {
        emoji.innerHTML = 'ğŸ®ğŸ®ğŸ‰';
        title.innerHTML = 'ëŒ€ë‹¨í•´ìš”!';
        message.innerHTML = 'ì´ë²ˆ ì£¼ ì •ë§ ì˜í–ˆì–´ìš”!<br>ì£¼ë§ ì–‘ì¼ ëª¨ë‘ ê²Œì„ì„ ì¦ê¸°ì„¸ìš”!<br>ë©‹ì§„ í•œ ì£¼ë¥¼ ë³´ëƒˆë„¤ìš”! ğŸ‘';
        showCelebration();
    } else if(score >= 40) {
        emoji.innerHTML = 'ğŸ®ğŸ˜Š';
        title.innerHTML = 'ì˜í–ˆì–´ìš”!';
        message.innerHTML = 'ì´ë²ˆ ì£¼ ìˆ˜ê³ í–ˆì–´ìš”!<br>ì£¼ë§ í•˜ë£¨ ê²Œì„ì„ ì¦ê¸°ì„¸ìš”!<br>ë‹¤ìŒ ì£¼ë„ í™”ì´íŒ…! ğŸ’ª';
    } else {
        emoji.innerHTML = 'ğŸŒ±ğŸ’ª';
        title.innerHTML = 'ë‹¤ì‹œ ì‹œì‘!';
        message.innerHTML = 'ì´ë²ˆ ì£¼ëŠ” ì•„ì‰½ì§€ë§Œ ê´œì°®ì•„ìš”!<br>ìƒˆë¡œìš´ í•œ ì£¼ê°€ ì‹œì‘ë¼ìš”.<br>ì¡°ê¸ˆì”© í•´ë‚˜ê°€ë©´ ë¶„ëª… ì˜í•  ìˆ˜ ìˆì–´ìš”!<br>í˜ë‚´ìš”! íŒŒì´íŒ…! ğŸŒŸ';
    }
    modal.classList.add('show');
}

// íƒ­ ì „í™˜
function switchTab(idx) {
    var tabs = ['tab0','tab1','tab2','tab3'];
    var contents = ['todayTab','weekTab','monthTab','historyTab'];
    for(var i=0; i<4; i++) {
        document.getElementById(tabs[i]).classList.remove('active');
        document.getElementById(contents[i]).classList.remove('active');
    }
    document.getElementById(tabs[idx]).classList.add('active');
    document.getElementById(contents[idx]).classList.add('active');
    
    if(idx===1) loadWeekStats();
    else if(idx===2) loadMonthStats();
    else if(idx===3) loadHistory();
}

function loadWeekStats() {
    var weekStart = getWeekStart(new Date());
    var weekEnd = new Date(weekStart);
    weekEnd.setDate(weekEnd.getDate()+6);
    document.getElementById('weekPeriod').textContent = 
        weekStart.toLocaleDateString('ko-KR')+' ~ '+weekEnd.toLocaleDateString('ko-KR');
    
    var readingCount=0, choreCount=0, specialCount=0;
    var calendarHTML = [];
    var dayNames = ['í† ','ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ'];
    
    for(var i=0; i<7; i++) {
        var currentDate = new Date(weekStart);
        currentDate.setDate(currentDate.getDate()+i);
        var dateStr = currentDate.toISOString().split('T')[0];
        try {
            var data = JSON.parse(localStorage.getItem('day_'+dateStr));
            if(data) {
                if(data.reading) readingCount++;
                if(data.chore) choreCount++;
                if(data.special) specialCount++;
                var score = (data.reading?10:0)+(data.chore?5:0)+(data.special?15:0)+(data.tantrum?-10:0);
                calendarHTML.push('<div class="day-box completed"><div class="day-name">'+dayNames[i]+'</div><div class="day-score">'+score+'ì </div></div>');
            } else {
                calendarHTML.push('<div class="day-box"><div class="day-name">'+dayNames[i]+'</div><div class="day-score">-</div></div>');
            }
        } catch(e) {
            calendarHTML.push('<div class="day-box"><div class="day-name">'+dayNames[i]+'</div><div class="day-score">-</div></div>');
        }
    }
    
    document.getElementById('weekReading').textContent = readingCount;
    document.getElementById('weekChore').textContent = choreCount;
    document.getElementById('weekSpecial').textContent = specialCount;
    document.getElementById('weekCalendar').innerHTML = calendarHTML.join('');
}

function loadMonthStats() {
    var now = new Date();
    var monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
    var monthEnd = new Date(now.getFullYear(), now.getMonth()+1, 0);
    document.getElementById('monthPeriod').textContent = 
        monthStart.toLocaleDateString('ko-KR')+' ~ '+monthEnd.toLocaleDateString('ko-KR');
    
    var readingCount=0, choreCount=0, specialCount=0;
    var books = {};
    var keys = Object.keys(localStorage).filter(function(k) { return k.indexOf('day_')===0; });
    
    for(var i=0; i<keys.length; i++) {
        try {
            var data = JSON.parse(localStorage.getItem(keys[i]));
            var recordDate = new Date(data.date);
            if(recordDate >= monthStart && recordDate <= monthEnd) {
                if(data.reading) {
                    readingCount++;
                    if(data.bookTitle) {
                        var bookKey = data.bookTitle.trim();
                        if(!books[bookKey]) {
                            books[bookKey] = {author:data.bookAuthor||'ì €ì ë¯¸ìƒ', dates:[]};
                        }
                        books[bookKey].dates.push(data.date);
                    }
                }
                if(data.chore) choreCount++;
                if(data.special) specialCount++;
            }
        } catch(e) {}
    }
    
    document.getElementById('monthReading').textContent = readingCount;
    document.getElementById('monthChore').textContent = choreCount;
    document.getElementById('monthSpecial').textContent = specialCount;
    document.getElementById('monthBooks').textContent = Object.keys(books).length;
    
    var booksList = document.getElementById('monthBooksList');
    var booksHTML = '';
    for(var title in books) {
        booksHTML += '<div class="reading-log"><div class="reading-log-title">ğŸ“š '+title+'</div>';
        booksHTML += '<div class="reading-log-detail">ì €ì: '+books[title].author+'</div>';
        booksHTML += '<div class="reading-log-detail">ì½ì€ ë‚ : '+books[title].dates.length+'ì¼</div></div>';
    }
    booksList.innerHTML = booksHTML || '<p style="text-align:center;color:#999;padding:20px;">ì•„ì§ ì½ì€ ì±…ì´ ì—†ì–´ìš”.</p>';
}

function loadHistory() {
    var historyList = document.getElementById('historyList');
    var keys = Object.keys(localStorage).filter(function(k) { return k.indexOf('day_')===0; }).sort().reverse();
    if(keys.length === 0) {
        historyList.innerHTML = '<p style="text-align:center;color:#999;padding:40px;">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”. ì˜¤ëŠ˜ë¶€í„° ì‹œì‘í•´ë³¼ê¹Œìš”? ğŸ˜Š</p>';
        return;
    }
    historyList.innerHTML = '';
    for(var i=0; i<keys.length; i++) {
        try {
            var data = JSON.parse(localStorage.getItem(keys[i]));
            var date = new Date(data.date);
            var dateStr = date.toLocaleDateString('ko-KR', {
                year:'numeric', month:'long', day:'numeric', weekday:'long'
            });
            var content = '';
            if(data.reading) {
                var readingInfo = 'ğŸ“– ë…ì„œ: ';
                if(data.bookTitle) {
                    readingInfo += '"'+data.bookTitle+'"';
                    if(data.bookAuthor) readingInfo += ' ('+data.bookAuthor+')';
                    if(data.readingText) readingInfo += '<div class="reading-log" style="margin-top:8px;">'+data.readingText+'</div>';
                } else {
                    readingInfo += data.readingText || 'ì™„ë£Œ';
                }
                content += '<div>'+readingInfo+'</div>';
            }
            if(data.chore) content += '<div>ğŸ§¹ ì§‘ì•ˆì¼: '+(data.choreText||'ì™„ë£Œ')+'</div>';
            if(data.special) content += '<div>â­ íŠ¹ë³„íˆ ì˜í•œ ì¼: '+(data.specialText||'ì™„ë£Œ')+'</div>';
            if(data.tantrum) content += '<div>ğŸ˜¤ ì§œì¦ë‚¸ ì¼: '+(data.tantrumText||'ìˆìŒ')+'</div>';
            if(content) {
                var item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = '<div class="history-date">'+dateStr+'</div><div class="history-content">'+content+'</div>';
                historyList.appendChild(item);
            }
        } catch(e) {}
    }
}
</script>

</body>
</html>
